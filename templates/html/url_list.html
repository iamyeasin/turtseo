{% load static %}

<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>URL LIST</title>

    <script src="https://code.jquery.com/jquery-3.5.1.min.js"
        integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css"
        integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous">
    <link rel="stylesheet" type="text/css" href="{% static 'style.css' %}">

    <!-- JS, Popper.js, and jQuery -->

    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"
        integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo"
        crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js"
        integrity="sha384-OgVRvuATP1z7JjHLkuOU7Xw704+h835Lr+6QL9UvYjZE3Ipu6Tp75j7Bh/kR0JKI"
        crossorigin="anonymous"></script>
</head>

<body>
    <div class="container">
        <h1>URL List Panel</h1>
    </div>

    <form method="POST">
        <div id="top" class="row">
            <div class="col-sm-6 container">
                <h5>Matched URL List:</h5>
                <ol>
                    <div id="list"></div>
                </ol>
            </div>
        </div>
    </form>

</body>

{% block script %}
<script>

    $(document).ready(function (e) {

        function setCookie(cname, cvalue, exdays) {
            var d = new Date();
            d.setTime(d.getTime() + (exdays * 24 * 60 * 60 * 1000));
            var expires = "expires=" + d.toUTCString();
            document.cookie = cname + "=" + cvalue + ";" + expires + ";path=/";
        }

        function getCookie(cname) {
            var name = cname + "=";
            var decodedCookie = decodeURIComponent(document.cookie);
            var ca = decodedCookie.split(';');
            for (var i = 0; i < ca.length; i++) {
                var c = ca[i];
                while (c.charAt(0) == ' ') {
                    c = c.substring(1);
                }
                if (c.indexOf(name) == 0) {
                    return c.substring(name.length, c.length);
                }
            }
            return "";
        }

        var key = getCookie("key_data");
        var compare = getCookie("compare_data");

        console.log(key, compare);

        $.ajax({
            type: 'POST',
            url: '/url_list', // A new url in django
            data: {
                'key_data': getCookie("key_data"),
                'compare_data': getCookie("compare_data"),
            },
            success: function (data) {
                var parseData = JSON.parse(data);
                for (var i = 0; i < parseData.url.length; i++) {
                    if (parseData.isKey[i] == 1) {
                        var str = "<li><b><span style=" + '"color:#46E956;"' + ">" + parseData.url[i] + "</span></b></li>"
                        $('#list').append(str);
                    }
                    else {
                        var str = "<li><b><span style=" + '"color:#000000;"' + ">" + parseData.url[i] + "</span></b></li>"
                        $('#list').append(str);
                    }
                }
                setCookie('key_data', "", 1);
                setCookie('compare_data', "", 1);
            },
            error: function (req, status, err) {
                alert("Didn't found any match");
            },
        });
    });

</script>
{% endblock %}

</html>